{% extends "base.html" %}

{% block name %}Organization{% endblock %}

{% block css %}
{% endblock %}

{% block content %}
<!-- Organization information Form Block -->
<div class="col-sm-10 col-sm-offset-1 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-1">
    <div class="block">
        <!-- Organization information Form Title -->
        <div class="block-title">
            <h2>Organization Information</h2>
        </div>
        <!-- END Organization information Form Title -->

        <!-- Organization information Form Content -->
        <form id="form-organization" method="post" class="form-horizontal">
            <div class="form-group form-actions">
                <div class="col-md-9 col-md-offset-3">
                    <button type="submit" class="btn btn-effect-ripple btn-primary">Submit</button>
                    <button type="reset" class="btn btn-effect-ripple btn-warning">Reset</button>
                </div>
            </div>
        </form>
        <!-- END Organization information Form Content -->
    </div>
    <!-- END Organization information Form Block -->
</div>
<!-- END Organization information Form Block -->
{% endblock %}

{% block js %}
<script src="{{ staticUrl }}/js/jquery.serialize-object.min.js"></script>
<script src="{{ staticUrl }}/js/form-builder.js"></script>
<script src="{{ staticUrl }}/js/rest-forms.js"></script>
<script>
    $(function(){
        BuildForm($("#form-organization"), [
            {
                id: "fullName",
                name: "fullName",
                label: "Full Name",
                type: "text",
                value: "{{ ctx.organization.FullName }}",
                rules: [
                    {
                        rule: "required",
                        value: true,
                        message: "Please enter your Organization's full name"
                    }
                ]
            },
            {
                id: "shortName",
                name: "shortName",
                label: "Short Name/Abbr",
                type: "text",
                value: "{{ ctx.organization.Name }}",
            },
            {
                id: "website",
                name: "website",
                label: "Website URL",
                type: "url",
                value: "{{ ctx.organization.Website }}",
            },
        ]);
    });
  var api = NewRestAPI(
      '{{ urlFor("api", "/organization2") }}',
      '{{ ctx.organization.MustGetTokenByName("live-secret-key") }}',
      $('#form-organization'),
      {
          price: function(val) {
              // To cents
              return parseFloat(val.replace(/[^\d.-]/g,''), 10) * 100;
          },
          weight: function(val) {
              return parseFloat(val.replace(/[^\d.-]/g,''), 10);
          }
      }
    );
  $('#form-organization').on('submit', function(e){
      var $form = $(this);
      requestAnimationFrame(function() {
          if ($('.form-group.has-error').length === 0) {
              api.put(function(data) {
                  window.location.replace('{{ urlFor("platform", "/organization") }}')
              }, $form, '{{ ctx.organization.Id() }}')
          }
      })
      e.preventDefault();
      return false;
  })
</script>
{% endblock %}
{% block menulink %}menu-organization{% endblock %}
