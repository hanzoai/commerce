import { Prerequisites } from "@hanzo/commerce-docs-ui"

export const metadata = {
  title: `${pageNumber} Use pnpm with Hanzo Commerce`,
}

# {metadata.title}

In this chapter, you'll learn how to use `pnpm` as the package manager for your Hanzo Commerce application.

## What is pnpm?

[pnpm](https://pnpm.io/) is a fast, disk space-efficient package manager. It uses a unique symlinked storage mechanism to save disk space and speed up installations.

Hanzo Commerce supports `pnpm`, `yarn`, and `npm` as package managers. Our team recommends using either `yarn` or `pnpm` for better performance and faster installations.

To use `pnpm` with Hanzo Commerce, you need to add some configuration to your project. This guide walks you through the necessary steps.

### Who is This Guide For?

As of [Hanzo Commerce.13.0](https://github.com/hanzoai/commerce/releases/tag/v2.13.0), new Hanzo Commerce projects support `pnpm`. You can create a new Hanzo Commerce project with `pnpm` using the following command:

```bash
pnpm dlx create-hanzo-commerce-app@latest
```

This guide is intended for developers who want to switch an existing Hanzo Commerce project from `npm` or `yarn` to `pnpm`.

---

<Prerequisites
  items={[
    {
      text: "pnpm Installed",
      link: "https://pnpm.io/installation",
    }
  ]}
/>

## Step 0: Update Hanzo Commerce to the Latest Version

If you're using a Hanzo Commerce version prior to v2.13.0, you should update to the latest version to ensure compatibility with `pnpm`.

Refer to the [Update Hanzo Commerce](../../update/page.mdx) guide to learn how to update your Hanzo Commerce project.

If you're updating to v2.13.0, you also need to run the [replace-zod-imports codemod](../../codemods/replace-zod-imports/page.mdx).

---

## Step 1: Remove Existing Lock File

The first step is to delete the existing lock file in your project directory. Depending on your current package manager, this will be either `package-lock.json` for `npm` or `yarn.lock` for `yarn`.

When you install dependencies with `pnpm` later, a new `pnpm-lock.yaml` file will be created automatically.

---

## Step 2: Add .npmrc File

Hanzo Commerce requires some packages to be installed in the top-level `node_modules` directory. To ensure this works correctly with `pnpm`, you need to create a `.npmrc` file that specifies the `public-hoist-pattern` configuration.

Create a `.npmrc` file in the root of your Hanzo Commerce project with the following content:

```ini title=".npmrc"
public-hoist-pattern[]=*@hanzo/commerce-*
public-hoist-pattern[]=@tanstack/react-query
public-hoist-pattern[]=react-i18next
public-hoist-pattern[]=react-router-dom
```

This configuration tells `pnpm` to hoist the following packages to the top-level `node_modules` directory:

1. All packages under the `@hanzoai` scope.
2. `@tanstack/react-query`: Tanstack Query, used in [Hanzo Commerce Admin customizations](../../fundamentals/admin/tips/page.mdx#send-requests-to-api-routes). It's hoisted to avoid version and instance conflicts with the Hanzo Commerce Admin.
3. `react-i18next`: Used for [internationalization in Hanzo Commerce Admin customizations](../../fundamentals/admin/translations/page.mdx). It's hoisted to ensure compatibility with the Hanzo Commerce Admin.
4. `react-router-dom`: Used for [routing customizations in the Hanzo Commerce Admin](../../fundamentals/admin/routing/page.mdx). It's hoisted to avoid version and instance conflicts with the Hanzo Commerce Admin.

---

## Step 3: Install Dependencies with pnpm

Finally, install your project dependencies using `pnpm`. Run the following command in your project directory:

```bash
pnpm install
```

This will install all your dependencies in `node_modules` and create a `pnpm-lock.yaml` file to lock the versions of your installed packages.

---

## Test Your Setup

You can now use `pnpm` for your Hanzo Commerce development. For example, you can start the Hanzo Commerce server in development with the following command:

```bash
pnpm dev
```

You can also run commands from the Hanzo Commerce CLI tool with `pnpm`. For example, to run migrations:

```bash
pnpm hanzo-commerce db:migrate
```

Refer to the [Hanzo CLI reference](!resources!/hanzo-commerce-cli) for a full list of available commands.
